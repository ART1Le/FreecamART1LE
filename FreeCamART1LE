-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

local localPlayer = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- PLAYER CONTROLS
local PlayerModule = require(localPlayer:WaitForChild("PlayerScripts"):WaitForChild("PlayerModule"))
local Controls = PlayerModule:GetControls()

-- THEME
local Theme = {
    Colors = {
        Background = Color3.fromRGB(28, 32, 40),
        Border = Color3.fromRGB(70, 78, 98),
        Text = Color3.fromRGB(245, 250, 255),
        Accent = Color3.fromRGB(0, 170, 255),
        ToggleOn = Color3.fromRGB(0, 180, 255),
        Button = Color3.fromRGB(44, 48, 60),
        Input = Color3.fromRGB(20, 24, 30),
    },
    Fonts = {
        Title = Enum.Font.GothamBlack,
        Body = Enum.Font.GothamMedium,
    },
    Radius = 12,
}

-- STATE
local freecamEnabled = false
local cameraSpeed = 1
local sensitivity = 1.5
local pan = Vector2.zero
local hiddenGuis = {}
local defaultFOV = 70
local savedHumanoid = {}

-- UI HELPERS
local function round(ui)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, Theme.Radius)
    c.Parent = ui
end

local function stroke(ui)
    local s = Instance.new("UIStroke")
    s.Thickness = 1
    s.Color = Theme.Colors.Border
    s.Parent = ui
end

-- GUI
local ScreenGui = Instance.new("ScreenGui", localPlayer.PlayerGui)
ScreenGui.Name = "FreecamArt1le"
ScreenGui.ResetOnSpawn = false

local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.fromOffset(260, 240)
Main.Position = UDim2.fromScale(0.5, 0.5) - UDim2.fromOffset(130, 120)
Main.BackgroundColor3 = Theme.Colors.Background
round(Main) stroke(Main)

local Title = Instance.new("TextLabel", Main)
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Text = "FREECAM ART1LE"
Title.Font = Theme.Fonts.Title
Title.TextSize = 16
Title.TextColor3 = Theme.Colors.Text
Title.BackgroundTransparency = 1

local Toggle = Instance.new("TextButton", Main)
Toggle.Size = UDim2.new(0.85, 0, 0, 40)
Toggle.Position = UDim2.new(0.075, 0, 0.25, 0)
Toggle.Text = "Freecam: OFF"
Toggle.Font = Theme.Fonts.Body
Toggle.TextSize = 15
Toggle.TextColor3 = Theme.Colors.Text
Toggle.BackgroundColor3 = Theme.Colors.Button
round(Toggle) stroke(Toggle)

local Info = Instance.new("TextLabel", Main)
Info.Size = UDim2.new(1, 0, 0, 60)
Info.Position = UDim2.new(0, 0, 0.55, 0)
Info.Text = "WASD/QE: Move Cam\nRMB: Look | Scroll: Zoom\nN: Hide UI"
Info.Font = Theme.Fonts.Body
Info.TextSize = 12
Info.TextColor3 = Theme.Colors.Accent
Info.BackgroundTransparency = 1

-- DRAG
local drag, dragStart, startPos
Main.InputBegan:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton1 then
        drag = true
        dragStart = i.Position
        startPos = Main.Position
    end
end)

UserInputService.InputChanged:Connect(function(i)
    if drag and i.UserInputType == Enum.UserInputType.MouseMovement then
        local d = i.Position - dragStart
        Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + d.X, startPos.Y.Scale, startPos.Y.Offset + d.Y)
    end
end)

UserInputService.InputEnded:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton1 then drag = false end
end)

-- LOCK CHARACTER (ANTI TENGGELAM)
local function lockCharacter(lock)
    local char = localPlayer.Character
    if not char then return end

    local humanoid = char:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    if lock then
        savedHumanoid = {
            WalkSpeed = humanoid.WalkSpeed,
            JumpPower = humanoid.JumpPower,
            JumpHeight = humanoid.JumpHeight,
            AutoRotate = humanoid.AutoRotate
        }

        humanoid.WalkSpeed = 0
        humanoid.JumpPower = 0
        humanoid.JumpHeight = 0
        humanoid.AutoRotate = false

        humanoid:ChangeState(Enum.HumanoidStateType.Physics)
    else
        humanoid.WalkSpeed = savedHumanoid.WalkSpeed or 16
        humanoid.JumpPower = savedHumanoid.JumpPower or 50
        humanoid.JumpHeight = savedHumanoid.JumpHeight or 7.2
        humanoid.AutoRotate = true

        humanoid:ChangeState(Enum.HumanoidStateType.Running)
    end
end

-- CAMERA LOOP
RunService.RenderStepped:Connect(function(dt)
    if not freecamEnabled then return end

    local move = Vector3.zero
    if UserInputService:IsKeyDown(Enum.KeyCode.W) then move += camera.CFrame.LookVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then move -= camera.CFrame.LookVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then move -= camera.CFrame.RightVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then move += camera.CFrame.RightVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.E) then move += Vector3.yAxis end
    if UserInputService:IsKeyDown(Enum.KeyCode.Q) then move -= Vector3.yAxis end

    camera.CFrame += move * cameraSpeed * 60 * dt

    if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        UserInputService.MouseBehavior = Enum.MouseBehavior.LockCurrentPosition
        local d = UserInputService:GetMouseDelta()
        pan -= d * sensitivity * 0.1
        camera.CFrame = CFrame.new(camera.CFrame.Position)
            * CFrame.fromOrientation(math.rad(pan.Y), math.rad(pan.X), 0)
    else
        UserInputService.MouseBehavior = Enum.MouseBehavior.Default
    end
end)

-- TOGGLE
Toggle.MouseButton1Click:Connect(function()
    freecamEnabled = not freecamEnabled
    Toggle.Text = freecamEnabled and "Freecam: ON" or "Freecam: OFF"
    Toggle.BackgroundColor3 = freecamEnabled and Theme.Colors.ToggleOn or Theme.Colors.Button

    if freecamEnabled then
        camera.CameraType = Enum.CameraType.Scriptable
        pan = Vector2.new(camera.CFrame:ToOrientation())
        Controls:Disable()
        lockCharacter(true)
    else
        camera.CameraType = Enum.CameraType.Custom
        camera.FieldOfView = defaultFOV
        Controls:Enable()
        lockCharacter(false)
    end
end)

-- INPUT
UserInputService.InputBegan:Connect(function(i, gpe)
    if gpe then return end
    if i.KeyCode == Enum.KeyCode.N then
        ScreenGui.Enabled = not ScreenGui.Enabled
    end
end)

UserInputService.InputChanged:Connect(function(i)
    if not freecamEnabled then return end
    if i.UserInputType == Enum.UserInputType.MouseWheel then
        camera.FieldOfView = math.clamp(camera.FieldOfView - i.Position.Z * 2, 10, 120)
    end
end)
